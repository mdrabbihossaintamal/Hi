<!DOCTYPE html>
<html lang="bn">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Mini Social (Local Demo)</title>
<style>
  :root{
    --bg: #f2f7fb;
    --card: #ffffff;
    --primary: #1877f2;
    --muted: #6b7280;
    --danger: #e53e3e;
  }
  *{box-sizing:border-box;font-family:Inter,ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial;}
  body{margin:0;background:linear-gradient(180deg,#e6f0ff 0%,var(--bg) 100%);min-height:100vh;padding:24px;display:flex;justify-content:center;}
  .app{width:100%;max-width:1100px;}
  header{display:flex;align-items:center;justify-content:space-between;margin-bottom:16px}
  .brand{display:flex;gap:12px;align-items:center}
  .logo{width:44px;height:44px;border-radius:8px;background:linear-gradient(135deg,#4f46e5,#06b6d4);display:flex;align-items:center;justify-content:center;color:white;font-weight:700}
  .title{font-size:18px;font-weight:700}
  .controls{display:flex;gap:8px;align-items:center}
  button, .btn{background:var(--primary);color:white;border:none;padding:8px 12px;border-radius:8px;cursor:pointer}
  .ghost{background:transparent;color:var(--primary);border:1px solid rgba(24,119,242,0.2)}
  .card{background:var(--card);border-radius:12px;box-shadow:0 6px 18px rgba(15,23,42,0.06);padding:16px;margin-bottom:16px}
  .grid{display:grid;grid-template-columns:320px 1fr;gap:16px}
  .profile-pic{width:96px;height:96px;border-radius:12px;background:#f3f4f6;display:flex;align-items:center;justify-content:center;overflow:hidden}
  .profile-pic img{width:100%;height:100%;object-fit:cover}
  input[type="text"], input[type="email"], input[type="password"], textarea, select {
    width:100%;padding:10px;border-radius:8px;border:1px solid #e6edf3;margin-top:8px;outline:none;
  }
  textarea{resize:vertical;min-height:80px}
  .small{font-size:13px;color:var(--muted)}
  .post-media{max-width:100%;border-radius:8px;margin-top:8px}
  .posts{display:flex;flex-direction:column;gap:12px}
  .post{padding:12px;border-radius:12px;border:1px solid #eef2f6;background:linear-gradient(180deg, #fff, #fcfeff)}
  .post .meta{display:flex;gap:12px;align-items:center}
  .avatar-sm{width:40px;height:40px;border-radius:8px;overflow:hidden;background:#f3f4f6}
  .avatar-sm img{width:100%;height:100%;object-fit:cover}
  .flex{display:flex;align-items:center;gap:8px}
  .muted{color:var(--muted);font-size:13px}
  .center{display:flex;align-items:center;justify-content:center}
  .danger{background:var(--danger)}
  .hidden{display:none}
  footer{margin-top:18px;text-align:center;color:var(--muted);font-size:13px}
  @media (max-width:880px){.grid{grid-template-columns:1fr;}.controls{flex-wrap:wrap}}
</style>
</head>
<body>
  <div class="app">
    <header>
      <div class="brand">
        <div class="logo">S</div>
        <div>
          <div class="title">Mini Social (Local Demo)</div>
          <div class="small">Demo: Signup, profile, posts (text/image/video), privacy</div>
        </div>
      </div>

      <div class="controls" id="topControls">
        <!-- populated by JS -->
      </div>
    </header>

    <div class="grid">
      <!-- LEFT: Profile / Auth -->
      <div>
        <div class="card" id="authCard">
          <!-- Auth content populated by JS -->
        </div>

        <div class="card">
          <h3>Quick Tips</h3>
          <ul class="small">
            <li>All data stored locally in your browser (localStorage).</li>
            <li>Image/video posts are stored as Base64 ‚Äî large files may exceed storage limits.</li>
            <li>Private posts are visible only to the owner when logged in (demo behavior).</li>
            <li>For real apps use a backend, secure auth, & object storage (S3).</li>
          </ul>
        </div>
      </div>

      <!-- RIGHT: Feed / Profile / Composer -->
      <div>
        <div class="card" id="profileCard" style="display:none;">
          <div style="display:flex;gap:12px;">
            <div class="profile-pic" id="profilePicWrap">
              <!-- profile image -->
            </div>
            <div style="flex:1">
              <h2 id="profileName">Name</h2>
              <div class="small" id="profileBio">Bio</div>
              <div style="margin-top:8px">
                <button class="btn" id="editProfileBtn">Edit Profile</button>
                <button class="ghost" id="viewMyPostsBtn">My Posts</button>
              </div>
            </div>
          </div>
        </div>

        <!-- Composer -->
        <div class="card" id="composerCard" style="display:none;">
          <h3>Create Post</h3>
          <textarea id="postText" placeholder="What's on your mind?"></textarea>
          <div style="display:flex;gap:8px;margin-top:8px;">
            <input type="file" id="postMedia" accept="image/*,video/*">
            <select id="postPrivacy">
              <option value="public">Public</option>
              <option value="private">Private (only you)</option>
            </select>
            <button class="btn" id="postBtn">Post</button>
          </div>
          <div id="postPreview" class="small muted" style="margin-top:8px"></div>
        </div>

        <!-- Feed -->
        <div class="card">
          <h3>Feed</h3>
          <div class="posts" id="feed">
            <!-- posts injected here -->
          </div>
        </div>

        <!-- Edit profile modal (in-card) -->
        <div class="card hidden" id="editProfileCard">
          <h3>Edit Profile</h3>
          <div style="display:flex;gap:12px;">
            <div class="profile-pic" id="editPicWrap"></div>
            <div style="flex:1">
              <input type="file" id="profileImageInput" accept="image/*">
              <input type="text" id="editName" placeholder="Full name" />
              <textarea id="editBio" placeholder="Short bio"></textarea>
              <div style="display:flex;gap:8px;margin-top:8px;">
                <button class="btn" id="saveProfileBtn">Save</button>
                <button class="ghost" id="cancelEditProfile">Cancel</button>
              </div>
              <div style="margin-top:12px;"><button class="danger" id="deleteAccountBtn">Delete Account</button></div>
            </div>
          </div>
        </div>

      </div>
    </div>

    <footer>Made for demo ‚Ä¢ Local-only. Refreshing the page keeps data (localStorage).</footer>
  </div>

<script>
/*
  Mini Social - client-side demo
  Data shapes:
   - users: [{id, name, email, password, avatar(base64|null), bio}]
   - posts: [{id, ownerId, text, media:{type:'image'|'video', data:base64}|null, privacy:'public'|'private', ts}]
*/

///// Utilities /////
const $ = (sel) => document.querySelector(sel);
const uid = () => 'id_' + Math.random().toString(36).slice(2,11);

function loadData(){
  const users = JSON.parse(localStorage.getItem('ms_users')||'[]');
  const posts = JSON.parse(localStorage.getItem('ms_posts')||'[]');
  const session = JSON.parse(localStorage.getItem('ms_session')||'null'); // {userId}
  return {users, posts, session};
}
function saveData({users, posts, session}){
  localStorage.setItem('ms_users', JSON.stringify(users));
  localStorage.setItem('ms_posts', JSON.stringify(posts));
  localStorage.setItem('ms_session', JSON.stringify(session));
}
function getCurrentUser(){
  const {users, session} = loadData();
  if(!session||!session.userId) return null;
  return users.find(u=>u.id===session.userId) || null;
}
function openFileAsBase64(file, cb){
  const fr = new FileReader();
  fr.onload = e => cb(e.target.result);
  fr.readAsDataURL(file);
}

///// Render top controls /////
function renderTopControls(){
  const top = $('#topControls');
  top.innerHTML = '';
  const me = getCurrentUser();
  if(me){
    const span = document.createElement('div');
    span.className = 'flex';
    span.innerHTML = `<div class="avatar-sm"><img src="${me.avatar||'data:image/svg+xml;utf8,<svg xmlns=\\'http://www.w3.org/2000/svg\\' width=40 height=40><rect width=40 height=40 fill=%23eef2f6/></svg>'}" /></div>
                      <div style="text-align:left"><div style="font-weight:700">${escapeHtml(me.name)}</div><div class="small muted">${escapeHtml(me.email)}</div></div>`;
    top.appendChild(span);

    const btnLogout = document.createElement('button');
    btnLogout.textContent = 'Logout';
    btnLogout.onclick = () => { logout(); };
    top.appendChild(btnLogout);
  }else{
    const btnLogin = document.createElement('button'); btnLogin.textContent='Login'; btnLogin.onclick=()=> showAuth('login');
    const btnSignup = document.createElement('button'); btnSignup.textContent='Sign Up'; btnSignup.className='ghost'; btnSignup.onclick=()=> showAuth('signup');
    top.appendChild(btnLogin); top.appendChild(btnSignup);
  }
}

///// Auth UI ///// 
function showAuth(mode='login'){
  const card = $('#authCard');
  card.innerHTML = '';
  if(mode==='login'){
    card.innerHTML = `
      <h3>Login</h3>
      <input type="email" id="loginEmail" placeholder="Email" />
      <input type="password" id="loginPassword" placeholder="Password" />
      <div style="margin-top:8px;display:flex;gap:8px">
        <button class="btn" id="doLogin">Login</button>
        <button class="ghost" id="toSignup">Sign Up</button>
      </div>
      <div id="authMsg" class="small muted" style="margin-top:8px"></div>
    `;
    $('#toSignup').onclick = () => showAuth('signup');
    $('#doLogin').onclick = doLogin;
  } else {
    card.innerHTML = `
      <h3>Sign Up</h3>
      <input type="text" id="signupName" placeholder="Full name" />
      <input type="email" id="signupEmail" placeholder="Email" />
      <input type="password" id="signupPassword" placeholder="Password" />
      <div style="margin-top:8px;display:flex;gap:8px">
        <button class="btn" id="doSignup">Create</button>
        <button class="ghost" id="toLogin">Login</button>
      </div>
      <div id="authMsg" class="small muted" style="margin-top:8px"></div>
    `;
    $('#toLogin').onclick = () => showAuth('login');
    $('#doSignup').onclick = doSignup;
  }
  $('#profileCard').style.display='none';
  $('#composerCard').style.display='none';
  $('#editProfileCard').classList.add('hidden');
}

function doSignup(){
  const name = $('#signupName').value.trim();
  const email = $('#signupEmail').value.trim().toLowerCase();
  const password = $('#signupPassword').value;
  const msg = $('#authMsg');
  if(!name||!email||!password){ msg.textContent='‡¶∏‡¶¨ ‡¶´‡¶ø‡¶≤‡ßç‡¶° ‡¶™‡ßÇ‡¶∞‡¶£ ‡¶ï‡¶∞‡ßÅ‡¶®'; return; }

  const data = loadData();
  if(data.users.find(u=>u.email===email)){ msg.textContent='‡¶è‡¶á ‡¶á‡¶Æ‡ßá‡¶á‡¶≤ ‡¶¶‡¶ø‡ßü‡ßá ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü ‡¶Ü‡¶õ‡ßá'; return; }

  const newUser = { id: uid(), name, email, password, avatar: null, bio: '' };
  data.users.push(newUser);
  data.session = { userId: newUser.id };
  saveData(data);
  msg.textContent = '‡¶∏‡¶æ‡¶á‡¶® ‡¶Ü‡¶™ ‡¶∏‡¶´‡¶≤ ‚Äî ‡¶≤‡¶ó ‡¶á‡¶® ‡¶π‡ßü‡ßá‡¶õ‡ßá';
  renderApp();
}

function doLogin(){
  const email = $('#loginEmail').value.trim().toLowerCase();
  const password = $('#loginPassword').value;
  const msg = $('#authMsg');
  if(!email||!password){ msg.textContent='‡¶á‡¶Æ‡ßá‡¶á‡¶≤ ‡¶ì ‡¶™‡¶æ‡¶∏‡¶ì‡ßü‡¶æ‡¶∞‡ßç‡¶° ‡¶¶‡¶ø‡¶®'; return; }

  const data = loadData();
  const u = data.users.find(x=>x.email===email && x.password===password);
  if(!u){ msg.textContent='‡¶á‡¶®‡¶´‡¶∞‡¶Æ‡ßá‡¶∂‡¶® ‡¶≠‡ßÅ‡¶≤ ‡¶¨‡¶æ ‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶®‡ßá‡¶á'; return; }
  data.session = { userId: u.id };
  saveData(data);
  msg.textContent = '‡¶≤‡¶ó‡¶á‡¶® ‡¶∏‡¶´‡¶≤';
  renderApp();
}

function logout(){
  const data = loadData();
  data.session = null;
  saveData(data);
  renderApp();
}

///// Profile rendering /////
function renderProfile(){
  const me = getCurrentUser();
  if(!me){
    $('#profileCard').style.display='none';
    $('#composerCard').style.display='none';
    $('#editProfileCard').classList.add('hidden');
    return;
  }
  $('#profileCard').style.display='block';
  $('#composerCard').style.display='block';
  $('#profilePicWrap').innerHTML = `<img src="${me.avatar || defaultAvatarSvg()}" alt="avatar">`;
  $('#profileName').textContent = me.name;
  $('#profileBio').textContent = me.bio || 'No bio yet';

  $('#editProfileBtn').onclick = () => {
    $('#editProfileCard').classList.remove('hidden');
    $('#editPicWrap').innerHTML = `<img src="${me.avatar || defaultAvatarSvg() }" alt="avatar">`;
    $('#editName').value = me.name;
    $('#editBio').value = me.bio;
  };
  $('#viewMyPostsBtn').onclick = ()=> renderFeed({filterOwner: me.id});
  $('#saveProfileBtn').onclick = saveProfile;
  $('#cancelEditProfile').onclick = ()=> $('#editProfileCard').classList.add('hidden');
  $('#profileImageInput').onchange = function(e){
    const f = e.target.files[0];
    if(!f) return;
    openFileAsBase64(f, (b64)=> {
      $('#editPicWrap').innerHTML = `<img src="${b64}">`;
      $('#editPicWrap').dataset.b64 = b64;
    });
  };
  $('#deleteAccountBtn').onclick = deleteAccount;
}

function saveProfile(){
  const me = getCurrentUser(); if(!me) return;
  const data = loadData();
  const users = data.users;
  const idx = users.findIndex(u=>u.id===me.id);
  if(idx<0) return;
  users[idx].name = $('#editName').value.trim() || users[idx].name;
  users[idx].bio = $('#editBio').value;
  const newB64 = $('#editPicWrap').dataset.b64;
  if(newB64) users[idx].avatar = newB64;
  saveData(data);
  $('#editProfileCard').classList.add('hidden');
  renderApp();
}

function deleteAccount(){
  if(!confirm('‡¶Ü‡¶™‡¶®‡¶ø ‡¶ï‡¶ø ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü ‡¶Æ‡ßÅ‡¶õ‡¶§‡ßá ‡¶ö‡¶æ‡¶®? ‡¶∏‡¶Æ‡¶∏‡ßç‡¶§ ‡¶™‡ßã‡¶∏‡ßç‡¶ü ‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶Ø‡¶æ‡¶¨‡ßá‡•§')) return;
  const me = getCurrentUser(); if(!me) return;
  const data = loadData();
  data.users = data.users.filter(u=>u.id!==me.id);
  data.posts = data.posts.filter(p=>p.ownerId!==me.id);
  data.session = null;
  saveData(data);
  renderApp();
}

function defaultAvatarSvg(){
  // small inline svg as data uri (keeps shape)
  return 'data:image/svg+xml;utf8,' + encodeURIComponent(`<svg xmlns="http://www.w3.org/2000/svg" width="200" height="200"><rect width="200" height="200" fill="#eef2f6"/><text x="50%" y="54%" dominant-baseline="middle" text-anchor="middle" fill="#94a3b8" font-family="Arial" font-size="70">üë§</text></svg>`);
}

///// Composer /////
function setupComposer(){
  $('#postMedia').onchange = function(e){
    const f = e.target.files[0];
    if(!f){ $('#postPreview').textContent=''; return; }
    $('#postPreview').textContent = `Selected: ${f.name} (${Math.round(f.size/1024)} KB)`;
  };
  $('#postBtn').onclick = createPost;
}

function createPost(){
  const me = getCurrentUser();
  if(!me){ alert('Please login to post'); return; }
  const text = $('#postText').value.trim();
  const file = $('#postMedia').files[0];
  const privacy = $('#postPrivacy').value;
  if(!text && !file){ alert('Please add text or media'); return; }

  const data = loadData();
  const newPost = { id: uid(), ownerId: me.id, text, media:null, privacy, ts: Date.now() };

  if(file){
    // convert to base64 (warning: can be large)
    openFileAsBase64(file, (b64) => {
      const type = file.type.startsWith('video')? 'video':'image';
      newPost.media = { type, data: b64 };
      data.posts.unshift(newPost); // show newest first
      saveData(data);
      resetComposer();
      renderFeed();
    });
  } else {
    data.posts.unshift(newPost);
    saveData(data);
    resetComposer();
    renderFeed();
  }
}

function resetComposer(){
  $('#postText').value='';
  $('#postMedia').value='';
  $('#postPreview').textContent='';
  $('#postPrivacy').value='public';
}

///// Feed rendering /////
function renderFeed(opts = {}) {
  // opts: {filterOwner: userId | null}
  const data = loadData();
  const me = getCurrentUser();
  const feedWrap = $('#feed');
  feedWrap.innerHTML = '';
  let posts = data.posts.slice(); // copy
  // apply owner filter if requested
  if(opts.filterOwner){
    posts = posts.filter(p => p.ownerId === opts.filterOwner);
  }
  // only show posts that are public or (private and owner is me)
  posts = posts.filter(p => {
    if(p.privacy === 'public') return true;
    if(!me) return false;
    return p.ownerId === me.id;
  });

  if(posts.length===0){
    feedWrap.innerHTML = `<div class="center small muted">No posts to show</div>`;
    return;
  }

  for(const p of posts){
    const owner = data.users.find(u=>u.id===p.ownerId) || {name:'Unknown', avatar: defaultAvatarSvg()};
    const postEl = document.createElement('div');
    postEl.className = 'post';
    postEl.innerHTML = `
      <div class="meta">
        <div class="avatar-sm"><img src="${owner.avatar||defaultAvatarSvg()}" /></div>
        <div style="flex:1">
          <div style="display:flex;justify-content:space-between;align-items:center">
            <div>
              <div style="font-weight:700">${escapeHtml(owner.name)}</div>
              <div class="muted small">${new Date(p.ts).toLocaleString()} ‚Ä¢ ${p.privacy}</div>
            </div>
            <div id="postActions_${p.id}"></div>
          </div>
          <div style="margin-top:8px">${escapeHtml(p.text)}</div>
        </div>
      </div>
    `;
    // media
    if(p.media){
      if(p.media.type==='image'){
        const img = document.createElement('img');
        img.className='post-media';
        img.src = p.media.data;
        postEl.appendChild(img);
      } else {
        const vid = document.createElement('video');
        vid.className='post-media';
        vid.controls = true;
        vid.src = p.media.data;
        postEl.appendChild(vid);
      }
    }

    // actions (edit/delete) only for owner
    if(me && me.id === p.ownerId){
      const actions = postEl.querySelector(`#postActions_${p.id}`);
      actions.innerHTML = `<button class="ghost" id="edit_${p.id}">Edit</button> <button class="danger" id="del_${p.id}">Delete</button>`;
      postEl.querySelector(`#edit_${p.id}`).onclick = ()=> editPost(p.id);
      postEl.querySelector(`#del_${p.id}`).onclick = ()=> deletePost(p.id);
    }

    feedWrap.appendChild(postEl);
  }
}

function editPost(postId){
  const data = loadData();
  const pIdx = data.posts.findIndex(x=>x.id===postId);
  if(pIdx<0) return;
  const p = data.posts[pIdx];
  const me = getCurrentUser();
  if(!me || me.id !== p.ownerId) { alert('Not allowed'); return; }

  // prefill composer with post data to edit
  $('#postText').value = p.text;
  $('#postPrivacy').value = p.privacy;
  $('#postPreview').textContent = p.media ? `Existing media attached (${p.media.type})` : '';
  // store editing marker
  $('#postBtn').textContent = 'Save';
  $('#postBtn').dataset.editId = postId;
  // change handler to save edit
  $('#postBtn').onclick = function saveEdit(){
    const newText = $('#postText').value.trim();
    const newPrivacy = $('#postPrivacy').value;
    const newFile = $('#postMedia').files[0];
    if(!newText && !newFile && !p.media){ alert('Add text or media'); return; }
    if(newFile){
      openFileAsBase64(newFile, (b64)=>{
        data.posts[pIdx].text = newText;
        data.posts[pIdx].privacy = newPrivacy;
        data.posts[pIdx].media = { type: newFile.type.startsWith('video') ? 'video':'image', data: b64 };
        saveData(data);
        // reset
        $('#postBtn').textContent = 'Post';
        $('#postBtn').dataset.editId = '';
        $('#postBtn').onclick = createPost;
        resetComposer();
        renderFeed();
      });
    } else {
      // no new file ‚Äî keep existing media
      data.posts[pIdx].text = newText;
      data.posts[pIdx].privacy = newPrivacy;
      saveData(data);
      $('#postBtn').textContent = 'Post';
      $('#postBtn').dataset.editId = '';
      $('#postBtn').onclick = createPost;
      resetComposer();
      renderFeed();
    }
  };
  // ensure composer visible
  $('#composerCard').style.display='block';
}

function deletePost(postId){
  if(!confirm('‡¶™‡ßã‡¶∏‡ßç‡¶ü ‡¶°‡¶ø‡¶≤‡¶ø‡¶ü ‡¶ï‡¶∞‡¶¨‡ßá‡¶®?')) return;
  const data = loadData();
  data.posts = data.posts.filter(p=>p.id!==postId);
  saveData(data);
  renderFeed();
}

///// Helpers /////
function escapeHtml(s){
  if(!s) return '';
  return s.replaceAll('&','&amp;').replaceAll('<','&lt;').replaceAll('>','&gt;').replaceAll('"','&quot;');
}

///// Init / render application /////
function renderApp(){
  renderTopControls();
  const me = getCurrentUser();
  if(!me){
    showAuth('login');
  } else {
    // hide auth card and display profile/composer
    $('#authCard').innerHTML = '';
    $('#profileCard').style.display='block';
    $('#composerCard').style.display='block';
    $('#editProfileCard').classList.add('hidden');
  }
  renderProfile();
  renderFeed();
}

// initial bindings
renderTopControls();
showAuth('login');
setupComposer();
renderFeed();

</script>
</body>
</html>
